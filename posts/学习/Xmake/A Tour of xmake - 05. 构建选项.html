<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>A Tour of xmake - 05. 构建选项 | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="常用C&#x2F;C++项目描述设置详解先来一段最简短的一行描述即可编译src目录下所有c源文件，然后生成一个名为demo的可执行文件。 1target(&quot;demo&quot;, &amp;#123;kind &#x3D; &quot;binary&quot;, files &#x3D; &quot;src&#x2F;*.c&quot;&amp;#125;)  上面的写法是精简写法，通常我们更推荐使用下面展开式写法： 123targ">
<meta property="og:type" content="article">
<meta property="og:title" content="A Tour of xmake - 05. 构建选项">
<meta property="og:url" content="http://example.com/posts/%E5%AD%A6%E4%B9%A0/Xmake/A%20Tour%20of%20xmake%20-%2005.%20%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="常用C&#x2F;C++项目描述设置详解先来一段最简短的一行描述即可编译src目录下所有c源文件，然后生成一个名为demo的可执行文件。 1target(&quot;demo&quot;, &amp;#123;kind &#x3D; &quot;binary&quot;, files &#x3D; &quot;src&#x2F;*.c&quot;&amp;#125;)  上面的写法是精简写法，通常我们更推荐使用下面展开式写法： 123targ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-05-04T02:11:42.000Z">
<meta property="article:modified_time" content="2023-07-24T11:14:08.878Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/web/favicon.png"><link rel="canonical" href="http://example.com/posts/%E5%AD%A6%E4%B9%A0/Xmake/A%20Tour%20of%20xmake%20-%2005.%20%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'A Tour of xmake - 05. 构建选项',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-24 19:14:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/web/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">33</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">A Tour of xmake - 05. 构建选项</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-04T02:11:42.000Z" title="发表于 2023-05-04 10:11:42">2023-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-24T11:14:08.878Z" title="更新于 2023-07-24 19:14:08">2023-07-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/Xmake/">Xmake</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="A Tour of xmake - 05. 构建选项"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="常用C-x2F-C-项目描述设置详解"><a href="#常用C-x2F-C-项目描述设置详解" class="headerlink" title="常用C&#x2F;C++项目描述设置详解"></a>常用C&#x2F;C++项目描述设置详解</h1><h3 id="先来一段最简短的"><a href="#先来一段最简短的" class="headerlink" title="先来一段最简短的"></a>先来一段最简短的</h3><p>一行描述即可编译src目录下所有c源文件，然后生成一个名为demo的可执行文件。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;demo&quot;, &#123;kind = &quot;binary&quot;, files = &quot;src/*.c&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>上面的写法是精简写法，通常我们更推荐使用下面展开式写法：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;demo&quot;) </span><br><span class="line">    set_kind(&quot;binary&quot;) </span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br></pre></td></tr></table></figure>

<p>这两者完全等价，如果配置很简短，可以完全精简成一行，而拆分成多行更加方便灵活配置。</p>
<p>如果没有特殊目的，下文我们都会采用第二段的写法。</p>
<h3 id="配置项目目标类型"><a href="#配置项目目标类型" class="headerlink" title="配置项目目标类型"></a>配置项目目标类型</h3><p>通常的C&#x2F;C++项目生成的目标文件猪油三大类：可执行程序，静态库，动态库。</p>
<p>我们可以通过<code>set_kind()</code>配置来设置，分别对应：binary, static, shared</p>
<p>例如，我们想要编译动态库，只需要修改kind：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;demo&quot;) </span><br><span class="line">    set_kind(&quot;shared&quot;) </span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="添加宏定义"><a href="#添加宏定义" class="headerlink" title="添加宏定义"></a>添加宏定义</h3><p>编译宏的设置，大多数c&#x2F;c++项目都会用到，一般如果我们设置编译flags传给gcc&#x2F;clang，都是要配置：<code>-DXXX</code></p>
<p>而在xmake里面，提供了<code>add_defines()</code>内置接口来配置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;demo&quot;) </span><br><span class="line">    set_kind(&quot;shared&quot;) </span><br><span class="line">    add_files(&quot;src/*.c&quot;) </span><br><span class="line">    add_defines(&quot;XXX&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="条件配置"><a href="#条件配置" class="headerlink" title="条件配置"></a>条件配置</h3><p>那如果我们想在不同编译平台，分别设置不同的宏开关呢？我们可以利用lua内置的if语句很方便的实现：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;demo&quot;) </span><br><span class="line">    set_kind(&quot;shared&quot;) </span><br><span class="line">    add_files(&quot;src/*.c&quot;) </span><br><span class="line">    add_defines(&quot;XXX&quot;) </span><br><span class="line">    if is_plat(&quot;linux&quot;, &quot;macosx&quot;) then </span><br><span class="line">       add_defines(&quot;YYY&quot;) </span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>我们通过<code>is_plat()</code>判断，如果当前编译目标平台是linux或者macosx，那么target会额外增加<code>-DYYY</code>宏定义。</p>
<h3 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h3><p>我们在<code>target(&quot;demo&quot;)</code>下面的所有配置，都属于demo这个target子域，并不是全局的，所以你会看到通常配置上都加了缩进，就是为了凸显作用域的影响范围。</p>
<p>通常如果多个target连续定义，下一个target定义就会自动结束上个target的作用域，每个target的配置完全独立，互不干扰：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test1&quot;)</span><br><span class="line">    set_kind(&quot;shared&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_defines(&quot;TEST1&quot;)</span><br><span class="line"></span><br><span class="line">target(&quot;test2&quot;)</span><br><span class="line">    set_kind(&quot;shared&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_defines(&quot;TEST2&quot;)</span><br></pre></td></tr></table></figure>

<p>例如，上面的配置两个target，各自拥有自己独立的宏定义：<code>TEST1</code>和<code>TEST2</code>。</p>
<p>那么，我们要对这两个target，设置共用的宏定义，应该如何配置呢？</p>
<p>每个target下面都配置一遍<code>add_defines(&quot;TEST&quot;)</code>? 当然可以，不过这样就有点冗余了，配置多了就会很难维护，其实我们只需要放置到全局根作用域就行了：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 全局设置</span><br><span class="line">add_defines(&quot;TEST&quot;)</span><br><span class="line">if is_arch(&quot;arm64&quot;, &quot;armv7&quot;) then</span><br><span class="line">    add_defines(&quot;ARM&quot;)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">target(&quot;test1&quot;)</span><br><span class="line">    set_kind(&quot;shared&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_defines(&quot;TEST1&quot;)</span><br><span class="line"></span><br><span class="line">target(&quot;test2&quot;)</span><br><span class="line">    set_kind(&quot;shared&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_defines(&quot;TEST2&quot;)</span><br></pre></td></tr></table></figure>

<p>在target的外层的所有配置都属于全局配置，我们也可以调用<code>target_end()</code>强制结束target子域，切回全局作用域：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test1&quot;)</span><br><span class="line">    set_kind(&quot;shared&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_defines(&quot;TEST1&quot;)</span><br><span class="line">target_end()</span><br><span class="line"></span><br><span class="line">-- 全局设置</span><br><span class="line">add_defines(&quot;TEST&quot;)</span><br><span class="line">if is_arch(&quot;arm64&quot;, &quot;armv7&quot;) then</span><br><span class="line">    add_defines(&quot;ARM&quot;)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">target(&quot;test2&quot;)</span><br><span class="line">    set_kind(&quot;shared&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_defines(&quot;TEST2&quot;)</span><br><span class="line">target_end()</span><br></pre></td></tr></table></figure>

<h3 id="添加编译选项"><a href="#添加编译选项" class="headerlink" title="添加编译选项"></a>添加编译选项</h3><p>如果有些编译选项，xmake没有提供内置api设置，那么我们可以退化到<code>add_cflags</code>, <code>add_cxflags</code>, <code>add_cxxflags</code>来设置， 不过这就需要用户自己去判断编译平台了，因为并不是所有编译flags每个平台都支持。</p>
<p>比如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add_cflags(&quot;-g&quot;, &quot;-O2&quot;, &quot;-DDEBUG&quot;)</span><br><span class="line">if is_plat(&quot;windows&quot;) then</span><br><span class="line">    add_cflags(&quot;/MT&quot;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>所有选项值都基于gcc的定义为标准，如果其他编译器不兼容（例如：vc），xmake会自动内部将其转换成对应编译器支持的选项值。 用户无需操心其兼容性，如果其他编译器没有对应的匹配值，那么xmake会自动忽略器设置。</p>
<p>我们也可以通过force参数来强制禁用flags的自动检测，直接传入编译器，哪怕编译器有可能不支持，也会设置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_cflags(&quot;-g&quot;, &quot;-O2&quot;, &#123;force = true&#125;)</span><br></pre></td></tr></table></figure>

<p>那如何知道，哪些flags检测失败给忽略了呢，带<code>-v</code>编译就可以看到，比如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ xmake -v</span><br><span class="line">checking for the /usr/bin/xcrun -sdk macosx clang ... ok</span><br><span class="line">checking for the flags (-Oz) ... ok</span><br><span class="line">checking for the flags (-Wno-error=deprecated-declarations) ... ok</span><br><span class="line">checking for the flags (-fno-strict-aliasing) ... ok</span><br><span class="line">checking for the flags (-Wno-error=expansion-to-defined) ... no</span><br></pre></td></tr></table></figure>

<p>最后备注下这三个api的区别：</p>
<ul>
<li><code>add_cflags</code>：仅添加C代码相关编译flags</li>
<li><code>add_cxflags</code>：添加C&#x2F;C++代码相关编译flags</li>
<li><code>add_cxxflags</code>：仅添加C++代码相关编译flags</li>
</ul>
<h3 id="添加库相关设置"><a href="#添加库相关设置" class="headerlink" title="添加库相关设置"></a>添加库相关设置</h3><p>一个C&#x2F;C++库的集成使用，通常需要设置头文件搜索目录，链接库名，库搜索目录，比如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test&quot;)</span><br><span class="line">    set_kind(&quot;binary&quot;)</span><br><span class="line">    add_links(&quot;pthread&quot;)</span><br><span class="line">    add_includedirs(&quot;/usr/local/include&quot;)</span><br><span class="line">    add_linkdirs(&quot;/usr/local/lib&quot;)</span><br></pre></td></tr></table></figure>

<p>通常，为了保证链接库的依赖顺序，系统库链接通常都会比较靠后，我们通过<code>add_syslinks()</code>来专门设置系统库链接，而<code>add_links()</code>通常用于非系统库链接：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test&quot;) </span><br><span class="line">    set_kind(&quot;binary&quot;) </span><br><span class="line">    add_links(&quot;A&quot;, &quot;B&quot;) </span><br><span class="line">    add_syslinks(&quot;pthread&quot;)</span><br></pre></td></tr></table></figure>

<p>上面的配置，我们添加了两个第三方链接库：A, B，以及系统库pthread，整个完整的链接顺序是：<code>-lA -lB -lpthread</code>，syslinks会放在最后面。</p>
<p>如果你不确定实际的链接顺序，我们可以执行<code>xmake -v</code>编译，查看完整的链接参数命令行。</p>
<h3 id="设置语言标准"><a href="#设置语言标准" class="headerlink" title="设置语言标准"></a>设置语言标准</h3><p>c标准和c++标准可同时进行设置，例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 设置c代码标准：c99， c++代码标准：c++11</span><br><span class="line">set_languages(&quot;c99&quot;, &quot;c++11&quot;)</span><br></pre></td></tr></table></figure>

<p>注：并不是设置了指定的标准，编译器就一定会按这个标准来编译，毕竟每个编译器支持的力度不一样，但是xmake会尽最大可能的去适配当前编译工具的支持标准。</p>
<p>例如：windows下vs的编译器并不支持按c99的标准来编译c代码，只能支持到c89，但是xmake为了尽可能的支持它，所以在设置c99的标准后， xmake会强制按c++代码模式去编译c代码，从一定程度上解决了windows下编译c99的c代码问题。</p>
<h3 id="设置编译优化"><a href="#设置编译优化" class="headerlink" title="设置编译优化"></a>设置编译优化</h3><p>xmake提供了几种内置的编译优化配置：none, fast, faster, fastest, smallest, aggressive，来实现各种级别的编译优化。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_optimize(&quot;fastest&quot;)</span><br></pre></td></tr></table></figure>

<p>如果用户通过flags来设置，还需额外考虑不同编译器的不同编译选项，xmake对其进行了内部映射处理，极大程度方便用户提供跨平台性。</p>
<p>如果想查看详细的映射规则，可以到xmake的官方文档进行查看：<a href="https://link.zhihu.com/?target=https://xmake.io/%23/zh-cn/manual/project_target?id=targetset_optimize">编译优化设置</a></p>
<h3 id="调试和发布模式"><a href="#调试和发布模式" class="headerlink" title="调试和发布模式"></a>调试和发布模式</h3><p>即使xmake提供了<code>set_optimize</code>简化了不同编译器的复杂配置，但是对于不同的编译模式: debug&#x2F;release，还是要自己做一些繁琐的判断和配置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if is_mode(&quot;debug&quot;) then</span><br><span class="line">    set_symbols(&quot;debug&quot;)</span><br><span class="line">    set_optimize(&quot;none&quot;)</span><br><span class="line">end</span><br><span class="line">if is_mode(&quot;release&quot;) then</span><br><span class="line">    set_symbols(&quot;hidden&quot;)</span><br><span class="line">    set_strip(&quot;all&quot;)</span><br><span class="line">    if is_plat(&quot;iphoneos&quot;, &quot;android&quot;) then</span><br><span class="line">        set_optimize(&quot;smallest&quot;)</span><br><span class="line">    else</span><br><span class="line">        set_optimize(&quot;fastest&quot;)</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>这些看似常用的设置，如果每个项目都来一遍，那也很繁琐了，导致xmake.lua不够精简可读，因此xmake提供了一些常用内置规则来简化设置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_rules(&quot;mode.release&quot;, &quot;mode.debug&quot;)</span><br></pre></td></tr></table></figure>

<p>只需这一行即可，效果是完全一致，用户还可以基于此在做一些额外的定制化配置来改写：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add_rules(&quot;mode.release&quot;, &quot;mode.debug&quot;) </span><br><span class="line">if is_mode(&quot;release&quot;) then </span><br><span class="line">    set_optimize(&quot;fastest&quot;) </span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>比如我想在release模式下，强制启用fastest编译优化，既然有了模式配置，那我们怎么切换到debug模式编译呢？（默认是release编译）</p>
<p>答案：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmake f -m debug; xmake</span><br></pre></td></tr></table></figure>

<h3 id="添加源文件"><a href="#添加源文件" class="headerlink" title="添加源文件"></a>添加源文件</h3><p>最后，我们在介绍下xmake最常用，也最为强大的设置之一，也就是对编译源文件的配置管理：<code>add_files()</code>。</p>
<p>我们可以用这个接口，添加各类xmake支持的源文件，比如：c&#x2F;c++, asm, objc, swift, go, dlang等源文件，甚至是：<code>.obj</code>, <code>.a/.lib</code>等二进制对象和库文件。</p>
<p>例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_files(&quot;src/test_*.c&quot;) </span><br><span class="line">add_files(&quot;src/xxx/**.cpp&quot;) </span><br><span class="line">add_files(&quot;src/asm/*.S&quot;, &quot;src/objc/**/hello.m&quot;)</span><br></pre></td></tr></table></figure>

<p>其中通配符<code>*</code>表示匹配当前目录下文件，而<code>**</code>则匹配多级目录下的文件。</p>
<p><code>add_files</code>的使用其实是相当灵活方便的，其匹配模式借鉴了premake的风格，但是又对其进行了改善和增强。</p>
<p>使得不仅可以匹配文件，还有可以在添加文件同时，过滤排除指定模式的一批文件。</p>
<p>例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 递归添加src下的所有c文件，但是不包括src/impl/下的所有c文件</span><br><span class="line">add_files(&quot;src/**.c|impl/*.c&quot;)</span><br><span class="line"></span><br><span class="line">-- 添加src下的所有cpp文件，但是不包括src/test.cpp、src/hello.cpp以及src下所有带xx_前缀的cpp文件</span><br><span class="line">add_files(&quot;src/*.cpp|test.cpp|hello.cpp|xx_*.cpp&quot;)</span><br></pre></td></tr></table></figure>

<p>其中分隔符<code>|</code>之后的都是需要排除的文件，这些文件也同样支持匹配模式，并且可以同时添加多个过滤模式，只要中间用<code>|</code>分割就行了。。</p>
<p>添加文件的时候支持过滤一些文件的一个好处就是，可以为后续根据不同开关逻辑添加文件提供基础。</p>
<p>注：为了使得描述上更加的精简，<code>|</code>之后的过滤描述都是基于起一个模式：<code>src/*.cpp</code> 中<code>*</code>之前的目录为基础的。 所以上面的例子后面过滤的都是在src下的文件，这个是要注意的。</p>
<p>2.1.6版本之后，对<code>add_files</code>进行了改进，支持基于files更细粒度的编译选项控制，例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test&quot;)</span><br><span class="line">    add_defines(&quot;TEST1&quot;)</span><br><span class="line">    add_files(&quot;src/*.c&quot;)</span><br><span class="line">    add_files(&quot;test/*.c&quot;, &quot;test2/test2.c&quot;, &#123;defines = &quot;TEST2&quot;, languages = &quot;c99&quot;, includedirs = &quot;.&quot;, cflags = &quot;-O0&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>可以在<code>add_files</code>的最后一个参数，传入一个配置table，去控制指定files的编译选项，里面的配置参数跟target的一致，并且这些文件还会继承target的通用配置<code>-DTEST1</code>。</p>
<p>2.1.9版本之后，支持添加未知的代码文件，通过设置rule自定义规则，实现这些文件的自定义构建，例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test&quot;) </span><br><span class="line">    -- ... </span><br><span class="line">    add_files(&quot;src/test/*.md&quot;, &#123;rule = &quot;markdown&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>并且在2.1.9版本之后，可以通过force参数来强制禁用cxflags,cflags等编译选项的自动检测，直接传入编译器，哪怕编译器有可能不支持，也会设置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_files(&quot;src/*.c&quot;, &#123;force = &#123;cxflags = &quot;-DTEST&quot;, mflags = &quot;-framework xxx&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="删除指定源文件"><a href="#删除指定源文件" class="headerlink" title="删除指定源文件"></a>删除指定源文件</h3><p>既然讲到了添加源文件，那么如何删除，我们也顺带着讲下吧，我们只需要通过<code>del_files()</code>接口，就可以从前面<code>add_files</code>接口添加的文件列表中，删除指定的文件，例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test&quot;) </span><br><span class="line">    add_files(&quot;src/*.c&quot;) </span><br><span class="line">    del_files(&quot;src/test.c&quot;)</span><br></pre></td></tr></table></figure>

<p>上面的例子，可以从<code>src</code>目录下添加除<code>test.c</code>以外的所有文件，当然这个也可以通过<code>add_files(&quot;src/*.c|test.c&quot;)</code>来达到相同的目的，但是这种方式更加灵活。</p>
<p>例如，我们可以条件判断来控制删除哪些文件，并且此接口也支持<code>add_files</code>的匹配模式，过滤模式，进行批量移除。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target(&quot;test&quot;) </span><br><span class="line">    add_files(&quot;src/**.c&quot;) </span><br><span class="line">    del_files(&quot;src/test*.c&quot;) </span><br><span class="line">    del_files(&quot;src/subdir/*.c|xxx.c&quot;) </span><br><span class="line">    if is_plat(&quot;iphoneos&quot;) then </span><br><span class="line">        add_files(&quot;xxx.m&quot;) </span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<p>通过上面的例子，我们可以看出<code>add_files</code>和<code>del_files</code>是根据调用顺序，进行顺序添加和删除的，并且通过<code>del_files(&quot;src/subdir/*.c|xxx.c&quot;)</code>删除一批文件， 并且排除<code>src/subdir/xxx.c</code>（就是说，不删除这个文件）。</p>
<h1 id="使用选项切换构建参数"><a href="#使用选项切换构建参数" class="headerlink" title="使用选项切换构建参数"></a>使用选项切换构建参数</h1><h3 id="添加构建选项"><a href="#添加构建选项" class="headerlink" title="添加构建选项"></a>添加构建选项</h3><p>xmake中使用<code>option</code>语句来声明构建选项。<code>option</code>的基本用法如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add_rules(<span class="string">&quot;mode.debug&quot;</span>, <span class="string">&quot;mode.release&quot;</span>)</span><br><span class="line">option(<span class="string">&quot;enable-verbose&quot;</span>)</span><br><span class="line">    set_default(<span class="literal">false</span>)</span><br><span class="line">    set_description(<span class="string">&quot;Enable verbose logging.&quot;</span>)</span><br><span class="line">    add_defines(<span class="string">&quot;MYEXE_VERBOSE&quot;</span>)</span><br><span class="line">target(<span class="string">&quot;myexe&quot;</span>)</span><br><span class="line">    set_kind(<span class="string">&quot;binary&quot;</span>)</span><br><span class="line">    add_files(<span class="string">&quot;src/*.cpp&quot;</span>)</span><br><span class="line">    add_options(<span class="string">&quot;enable-verbose&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>注意与<code>target</code>语句类似，<code>option</code>也是一个作用域的开始，之后一直到另一个作用域开始，或者显式的<code>option_end</code>调用之前的语句都是修饰当前option的。在上面的语句中，<code>option</code>作用域一共含有三条语句。</p>
<ul>
<li><code>set_default</code>语句设置option的默认值。xmake中option可分为两类：boolean和string。boolean类型的默认值可以是<code>true</code>、<code>false</code>或者<code>nil</code>，string类型的默认值可以是任意字符串或者<code>nil</code>。</li>
<li><code>set_description</code>语句设置option的描述语句。这一描述可以在通过运行<code>xmake config -h</code>或者<code>xmake config --menu</code>查看所有option时看到。</li>
<li><code>add_defines</code>为option加入了一个预定义宏。默认情况下，在使用<code>add_options</code>将option加入target时，如果option含有预定义宏、编译参数等，并且option的状态是启用的（不是<code>nil</code>或<code>false</code>），则target也会加入这些预定义宏和编译参数。</li>
</ul>
<blockquote>
<p>Tips. xmake中作用域级别的语句有六种：<code>target</code>和<code>target_end</code>、<code>package</code>和<code>package_end</code>，<code>option</code>和<code>option_end</code>、<code>rule</code>和<code>rule_end</code>、<code>toolchain</code>和<code>toolchain_end</code>、<code>task</code>和<code>task_end</code>。其中前面三种比较常用。</p>
</blockquote>
<p>除了<code>add_defines</code>之外，xmake中的option还支持<code>add_&lt;language&gt;flags</code>系列函数。如果要作更复杂的控制，可以使用<code>has_config</code>和<code>is_config</code>语句来进行判断：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add_rules(<span class="string">&quot;mode.debug&quot;</span>, <span class="string">&quot;mode.release&quot;</span>)</span><br><span class="line">option(<span class="string">&quot;with-openssl&quot;</span>, &#123;default = <span class="literal">false</span>, description = <span class="string">&quot;Build with OpenSSL.&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">if</span> has_config(<span class="string">&quot;with-openssl&quot;</span>) <span class="keyword">then</span></span><br><span class="line">    add_requires(<span class="string">&quot;openssl&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">target(<span class="string">&quot;myexe&quot;</span>)</span><br><span class="line">    set_kind(<span class="string">&quot;binary&quot;</span>)</span><br><span class="line">    add_files(<span class="string">&quot;src/*.cpp&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> has_config(<span class="string">&quot;with-openssl&quot;</span>) <span class="keyword">then</span></span><br><span class="line">        add_packages(<span class="string">&quot;openssl&quot;</span>)</span><br><span class="line">        add_defines(<span class="string">&quot;MYEXE_HAVE_OPENSSL&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>这里用到了<code>option</code>的简写格式，这一格式下<code>option</code>不再作为作用域开始的标记。</p>
<h3 id="内置选项"><a href="#内置选项" class="headerlink" title="内置选项"></a>内置选项</h3><p>xmake提供了一系列内置选项，在给自定义选项命名时记得避免与内置选项重名！常用的内置选项有：</p>
<ul>
<li><code>plat</code>：设置构建目标平台。</li>
<li><code>arch</code>：设置构建目标架构。</li>
<li><code>mode</code>：设置构建模式。</li>
<li><code>kind</code>：设置默认链接库类型。</li>
<li><code>buildir</code>：设置生成位置。默认为<code>build</code>，可以使用这一选项更改。推荐对不同的选项组合使用不同的生成位置以避免冲突。</li>
</ul>
<p>还有一些可能比较少用但很容易重名的内置选项，包括<code>qt</code>、<code>cuda</code>、<code>ndk</code>、<code>sdk</code>等。这些选项的清单及其作用可以运行<code>xmake config -h</code>查看。</p>
<h3 id="指定构建选项"><a href="#指定构建选项" class="headerlink" title="指定构建选项"></a>指定构建选项</h3><p>xmake在configure阶段指定各种构建选项。对boolean选项与string选项类型的指定方式类似，稍有不同：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ xmake config --opt1=yes --opt2=y --opt3=on # yes/no, y/n, on/off are all valid</span><br><span class="line">$ xmake config --str1=mystr &quot;--str2=some string&quot;</span><br></pre></td></tr></table></figure>

<p>当构建选项较多时，一个一个指定是一件很困难的事情。这时可以将一组选项导出为列表，切换时可以在列表间切换。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ xmake config --opt1=yes --opt2=mystr --buildir=build-preset1</span><br><span class="line">$ xmake config --export=preset1.txt</span><br></pre></td></tr></table></figure>

<p>这样就可以把当前所有构建选项导出到preset1.txt文件。需要导入构建选项时，执行</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xmake config -c --import=preset1.txt</span><br></pre></td></tr></table></figure>

<p>这里<code>-c</code>表示先清除其他选项设置，避免干扰。</p>
<h3 id="构建选项依赖"><a href="#构建选项依赖" class="headerlink" title="构建选项依赖"></a>构建选项依赖</h3><p>xmake中使用<code>add_deps</code>语句来声明选项之间的依赖关系。例如，选项opt2依赖选项opt1，当设置opt1时opt2自动取消，xmake.lua如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">option(<span class="string">&quot;opt1&quot;</span>, &#123;default = <span class="literal">false</span>&#125;)</span><br><span class="line">option(<span class="string">&quot;opt2&quot;</span>)</span><br><span class="line">    set_default(<span class="literal">true</span>)</span><br><span class="line">    add_deps(<span class="string">&quot;opt1&quot;</span>)</span><br><span class="line">    after_check(<span class="function"><span class="keyword">function</span> <span class="params">(option)</span></span></span><br><span class="line">        <span class="keyword">if</span> option:dep(<span class="string">&quot;opt1&quot;</span>):enabled() <span class="keyword">then</span></span><br><span class="line">            option:enable(<span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">option_end()</span><br></pre></td></tr></table></figure>

<p>这里<code>after_check</code>语句接收了一个Lua lambda表达式作为参数，这个表达式函数会在选项的检查结束后执行，将opt2设置为与opt1相容的值。<code>option：enable(false)</code>中<code>option</code>是函数的参数，调用函数时这个参数由xmake来构造。<code>enable</code>是<code>option</code>的一个函数，用于修改boolean类型option的值。对于string类型的option，这里可以使用<code>set_value</code>函数来设置：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> option:dep(<span class="string">&quot;opt1&quot;</span>):enabled() <span class="keyword">then</span></span><br><span class="line">    option:set_value(<span class="string">&quot;opt1&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips. 所有<code>option</code>默认是并行检查的，其先后顺序仅能通过<code>add_deps</code>控制。不加<code>add_deps</code>语句，在<code>after_check</code>中取其他<code>option</code>的值是未定义行为！</p>
</blockquote>
<p>xmake中大量使用了这类函数式方法用来灵活控制构建的每个过程。在lambda表达式函数之内的部分称为Script Scope，与之对应的xmake.lua中外面的部分称为Description Scope。Description Scope胜在简洁方便，易读易写；而只有在Script Scope内才可以使用xmake提供的全部功能，包括xmake提供的大量第三方Lua模块。这些功能可以在官方文档中找到。</p>
<blockquote>
<p>Tips. Description Scope内的语句会多次解析执行，而Script Scope内的语句只会执行一遍。不同option&#x2F;不同target的Script Scope默认是并行执行的。调试用的<code>print</code>语句应当写在Script Scope内，并标注当前所在的option&#x2F;target。</p>
</blockquote>
<p>常用的能够进入Script Scope的语句目前有如下一些。</p>
<p>option：</p>
<ul>
<li><code>before_check</code>&#x2F;<code>on_check</code>&#x2F;<code>after_check</code> configure阶段</li>
</ul>
<p>target：</p>
<ul>
<li><code>on_config</code> configure阶段</li>
<li><code>before_build</code>&#x2F;<code>on_build</code>&#x2F;<code>after_build</code> build阶段</li>
<li><code>before_link</code>&#x2F;<code>on_link</code>&#x2F;<code>after_link</code> build阶段</li>
<li><code>before_run</code>&#x2F;<code>on_run</code>&#x2F;<code>after_run</code> 运行<code>xmake run &lt;target&gt;</code>时</li>
<li><code>before_install</code>&#x2F;<code>on_install</code>&#x2F;<code>after_install</code> 运行<code>xmake install &lt;target&gt;</code>时</li>
<li><code>on_uninstall</code> 运行<code>xmake uninstall &lt;target&gt;</code>时</li>
<li><code>before_clean</code>&#x2F;<code>on_clean</code>&#x2F;<code>after_clean</code> 运行<code>xmake clean &lt;target&gt;</code>时</li>
</ul>
<h2 id="检测开发环境"><a href="#检测开发环境" class="headerlink" title="检测开发环境"></a>检测开发环境</h2><p>xmake中，option不仅用来处理用户指定的构建选项，还可以用来执行环境检测。这时option的写法为</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">option(<span class="string">&quot;__have_longlong&quot;</span>)</span><br><span class="line">    set_default(<span class="literal">false</span>)</span><br><span class="line">    set_showmenu(<span class="literal">false</span>) <span class="comment">-- do not show this option in the configuration menu</span></span><br><span class="line">    add_ctypes(<span class="string">&quot;long long int&quot;</span>)</span><br><span class="line">option_end()</span><br><span class="line"><span class="keyword">if</span> has_config(<span class="string">&quot;__have_longlong&quot;</span>) <span class="keyword">then</span></span><br><span class="line">    add_defines(<span class="string">&quot;HAVE_LONGLONG&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>这里在<code>option</code>中加入了<code>add_ctypes</code>语句，这使得<code>__have_longlong</code>这个option成为了一个检测option。xmake中，包含以下语句中一个或者多个的option为检测option：</p>
<ul>
<li><code>add_cincludes</code>&#x2F;<code>add_cxxincludes</code>：检测是否能找到某个头文件。</li>
<li><code>add_ctypes</code>&#x2F;<code>add_cxxtypes</code>：检测是否声明某个类型。通常与上一条联合使用，通过<code>add_cincludes</code>添加头文件，再通过<code>add_ctypes</code>检测头文件中声明的类型。</li>
<li><code>add_cfuncs</code>&#x2F;<code>add_cxxfuncs</code>：检测是否声明某个函数。同上，通常通过<code>add_cincludes</code>添加头文件，再通过<code>add_cfuncs</code>检测头文件中声明的函数。</li>
<li><code>add_links</code>：检测是否能找到某个链接库。</li>
<li><code>add_features</code>：检测编译器功能，例如<code>add_features(&quot;cxx_std_11&quot;)</code>检测是否支持C++11.</li>
<li><code>add_csnippets</code>&#x2F;<code>add_cxxsnippets</code>：检测是否能通过编译某代码片段。这条语句功能最强大，可以实现上面提到的各种功能，还可以通过添加参数来检测是否能运行某代码片段，获取该代码片段的输出。详情可参考官方文档。</li>
</ul>
<p>使用option进行检测有时还是太复杂了，这时可以使用xmake提供的更简单的检测接口。下面的代码段和上面检测<code>long long int</code>的片段作用相同：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">includes(<span class="string">&quot;check_ctypes.lua&quot;</span>)</span><br><span class="line">check_ctypes(<span class="string">&quot;HAVE_LONGLONG&quot;</span>, <span class="string">&quot;long long int&quot;</span>)</span><br><span class="line"><span class="comment">--[[ if has_config(&quot;__HAVE_LONGLONG&quot;) then</span></span><br><span class="line"><span class="comment">    do something</span></span><br><span class="line"><span class="comment">end --]]</span></span><br></pre></td></tr></table></figure>

<p>检测接口通过<code>includes</code>方法引入，其中<code>check_ctypes.lua</code>为xmake内置的扩展脚本。需要注意的是，为了避免选项冲突，xmake会自动将这里定义的选项命名为双下划线<code>__</code>接要定义的宏名称<code>HAVE_LONGLONG</code>。xmake中一共提供了如下简化检测接口。</p>
<ul>
<li><code>check_cflags.lua</code>&#x2F;<code>check_cxxflags.lua</code></li>
<li><code>check_cincludes.lua</code>&#x2F;<code>check_cxxincludes.lua</code></li>
<li><code>check_ctypes.lua</code>&#x2F;<code>check_cxxtypes.lua</code></li>
<li><code>check_cfuncs.lua</code>&#x2F;<code>check_cxxfuncs.lua</code></li>
<li><code>check_csnippets.lua</code>&#x2F;<code>check_cxxsnippets.lua</code></li>
<li><code>check_links.lua</code></li>
<li><code>check_features.lua</code></li>
<li><code>check_macros.lua</code></li>
</ul>
<p>大部分接口都和上面<code>option</code>的同名函数一一对应。其中三个接口例外：<code>check_cflags</code>和<code>check_cxxflags</code>检测编译器是否支持某个编译参数，而<code>check_macros</code>检测编译器是否设置某个预定义宏。<code>macros</code>检测都可以通过在<code>option</code>中设置<code>add_csnippets</code>和<code>add_cxxsnippets</code>来实现，而<code>flags</code>检测需要借助<code>on_check</code>进入Script Scope来处理。感兴趣的读者可以从<code>path/to/xmake/includes</code>找到这些接口的实现。</p>
<h2 id="生成配置头文件"><a href="#生成配置头文件" class="headerlink" title="生成配置头文件"></a>生成配置头文件</h2><p>当各种配置选项定义的宏仅影响源文件时，上面的开发环境检测功能就足够了。但是，当这些宏还影响头文件时，光在构建期检测是不够的，因为打包发布库与头文件时，不会包含任何检测结果的数据，这会导致头文件与库中的函数不匹配，最终导致链接失败。解决办法就是使用配置头文件（Configuration Headers）。</p>
<p>配置头文件是一个在构建时生成的文件，它根据检测到的各类选项来设置其中定义的宏变量。在构建过程中，先生成配置头文件，然后将该头文件加入项目中一起编译，最后一起打包发布。由于配置头文件的内容在构建时已经固定下来，如果构建头文件使用正确，头文件中将不再含有不清晰的分支，这也就避免了函数不匹配的问题。</p>
<p>一个使用配置头文件的项目目录如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line">|- include</span><br><span class="line">    |- mylib</span><br><span class="line">        |- mylib.h</span><br><span class="line">        |- config.h.in</span><br><span class="line">|- src</span><br><span class="line">    |- mylib.cpp</span><br><span class="line">|- xmake.lua</span><br></pre></td></tr></table></figure>

<p>其中mylib.h文件内容如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __WIN32__</span></span><br><span class="line"><span class="meta">#  <span class="keyword">ifdef</span> MYLIB_STATIC</span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> MYLIB_EXPORT</span></span><br><span class="line"><span class="meta">#  <span class="keyword">elif</span> defined(MYLIB_BUILDING)</span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> MYLIB_EXPORT __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> MYLIB_EXPORT __declspec(dllimport)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> MYLIB_EXPORT</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYLIB_EXPORT <span class="type">int</span> <span class="title">myfunc</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>mylib.cpp包含<code>myfunc</code>函数的实现</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mylib/mylib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">myfunc</span><span class="params">(<span class="type">int</span> a)</span> </span>&#123; <span class="keyword">return</span> a + <span class="number">1</span>; &#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://link.zhihu.com/?target=http://config.h.in">http://config.h.in</a>文件内容如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line">$&#123;define MYLIB_STATIC&#125;</span><br></pre></td></tr></table></figure>

<p>xmake.lua内容如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add_rules</span>(<span class="string">&quot;mode.debug&quot;</span>, <span class="string">&quot;mode.release&quot;</span>)</span><br><span class="line"><span class="built_in">target</span>(<span class="string">&quot;mylib&quot;</span>)</span><br><span class="line">    <span class="built_in">set_kind</span>(<span class="string">&quot;$(kind)&quot;</span>)</span><br><span class="line">    <span class="built_in">add_files</span>(<span class="string">&quot;src/mylib.cpp&quot;</span>)</span><br><span class="line">    <span class="built_in">add_includedirs</span>(<span class="string">&quot;include&quot;</span>)</span><br><span class="line">    <span class="built_in">add_defines</span>(<span class="string">&quot;MYLIB_BUILDING&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">is_kind</span><span class="params">(<span class="string">&quot;static&quot;</span>)</span> then</span></span><br><span class="line"><span class="function">        <span class="title">set_configvar</span><span class="params">(<span class="string">&quot;MYLIB_STATIC&quot;</span>, <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">    end</span></span><br><span class="line"><span class="function">    <span class="title">set_configdir</span><span class="params">(<span class="string">&quot;$(buildir)/mylib&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">add_includedirs</span><span class="params">(<span class="string">&quot;$(buildir)/mylib&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">add_configfiles</span><span class="params">(<span class="string">&quot;include/mylib/config.h.in&quot;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>运行<code>xmake</code>构建以上项目后，可以在<code>build/mylib</code>文件夹下找到一个文件config.h：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYLIB_STATIC 1</span></span><br></pre></td></tr></table></figure>

<p>在<code>mylib.h</code>文件中引用的头文件<code>config.h</code>正是这一文件。在发布时，将这一文件与<code>include</code>文件夹下的头文件一同打包，即可把<code>MYLIB_STATIC</code>这个设置项固定下来了。当其他文件引用<code>mylib.h</code>时，宏<code>MYLIB_EXPORT</code>将始终展开为空值。</p>
<blockquote>
<p>Tips. 上面的头文件设置看似很复杂，但却是大型C++项目中非常常见的做法。这么做的原因是在Windows上要使用MSVC导出可以链接的动态库，必须要显式声明需要导出的符号，声明的方式其一是在<code>.def</code>文件中集中声明，其二就是在函数前加<code>__declspec(dllexport)</code>。加导出声明后，相应函数的符号会以<code>__imp_</code>开头，以区分于静态库符号。为了避免符号冲突，若需要其他项目链接该动态库，则必须在库的头文件相应函数前加<code>__declspec(dllimport)</code>。<br>Tips. config.h是一个很常见的名称，如果安装的时候直接把这个文件所在的文件夹放在<code>include</code>下，很容易引起混乱。解决办法有两种：一种是改名mylib_config.h，另一种是放在文件夹mylib下。这也是上面写<code>#include &quot;mylib/mylib.h&quot;</code>的原因。</p>
</blockquote>
<p>xmake中，默认配置头文件以后缀<code>.h.in</code>结尾，在生成文件时去掉后缀的<code>.in</code>。这一行为也可以通过添加参数<code>&#123;filename = ...&#125;</code>进行更改。在配置头文件中有两种方法声明需替换的配置变量：</p>
<ul>
<li><code>$&#123;VAR&#125;</code>：替换为变量<code>VAR</code>的值，或者空字符串。常用于<code>#define VAR $&#123;VAR&#125;</code>。</li>
<li><code>$&#123;define VAR&#125;</code>：如果<code>VAR</code>的值存在，则定义<code>VAR</code>，否则注释掉当前行。要求写在行首。</li>
</ul>
<p>变量的值可以用<code>set_configvar</code>语句指定。<code>set_configvar</code>语句可以结合<code>option</code>使用，根据不同的选项设置不同的配置变量：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">option(<span class="string">&quot;with-openssl&quot;</span>, &#123;default = <span class="literal">false</span>, description = <span class="string">&quot;Build with OpenSSL.&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">if</span> has_config(<span class="string">&quot;with-openssl&quot;</span>) <span class="keyword">then</span></span><br><span class="line">    add_requires(<span class="string">&quot;openssl&quot;</span>)</span><br><span class="line">    set_configvar(<span class="string">&quot;WITH_OPENSSL&quot;</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>进一步还可以结合<code>set_configvar</code>与环境探测。xmake中已经预先提供了这样的接口，它们与<code>check_xxx</code>系列接口一脉相承，命名为<code>configvar_check_xxx</code>，用法如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">includes(<span class="string">&quot;check_ctypes.lua&quot;</span>)</span><br><span class="line">configvar_check_ctypes(<span class="string">&quot;HAVE_LONGLONG&quot;</span>, <span class="string">&quot;long long int&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>如果类型<code>long long int</code>可以通过编译，则变量<code>HAVE_LONGLONG</code>将被替换为1，否则变量<code>HAVE_LONGLONG</code>值不存在。使用<code>configvar_check_xxx</code>接口设置的option选项命名仍为双下划线<code>__</code>+变量名。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/posts/%E5%AD%A6%E4%B9%A0/Xmake/A%20Tour%20of%20xmake%20-%2005.%20%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9.html">http://example.com/posts/%E5%AD%A6%E4%B9%A0/Xmake/A%20Tour%20of%20xmake%20-%2005.%20%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E5%AD%A6%E4%B9%A0/Xmake/A%20Tour%20of%20xmake%20-%2006.%20%E6%B5%8B%E8%AF%95%E5%8F%91%E5%B8%83.html" title="A Tour of xmake - 06. 测试发布"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">A Tour of xmake - 06. 测试发布</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E5%AD%A6%E4%B9%A0/Xmake/A%20Tour%20of%20xmake%20-%2004.%20%E4%BE%9D%E8%B5%96%E4%BB%93%E5%BA%93.html" title="A Tour of xmake - 04. 依赖仓库"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">A Tour of xmake - 04. 依赖仓库</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/web/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">33</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8C-x2F-C-%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0%E8%AE%BE%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">常用C&#x2F;C++项目描述设置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E6%9D%A5%E4%B8%80%E6%AE%B5%E6%9C%80%E7%AE%80%E7%9F%AD%E7%9A%84"><span class="toc-number">1.0.1.</span> <span class="toc-text">先来一段最简短的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE%E7%9B%AE%E6%A0%87%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.0.2.</span> <span class="toc-text">配置项目目标类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-number">1.0.3.</span> <span class="toc-text">添加宏定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">1.0.4.</span> <span class="toc-text">条件配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.0.5.</span> <span class="toc-text">全局配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%BC%96%E8%AF%91%E9%80%89%E9%A1%B9"><span class="toc-number">1.0.6.</span> <span class="toc-text">添加编译选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%BA%93%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.0.7.</span> <span class="toc-text">添加库相关设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86"><span class="toc-number">1.0.8.</span> <span class="toc-text">设置语言标准</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96"><span class="toc-number">1.0.9.</span> <span class="toc-text">设置编译优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%92%8C%E5%8F%91%E5%B8%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.0.10.</span> <span class="toc-text">调试和发布模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.11.</span> <span class="toc-text">添加源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.12.</span> <span class="toc-text">删除指定源文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%80%89%E9%A1%B9%E5%88%87%E6%8D%A2%E6%9E%84%E5%BB%BA%E5%8F%82%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">使用选项切换构建参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9"><span class="toc-number">2.0.1.</span> <span class="toc-text">添加构建选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">2.0.2.</span> <span class="toc-text">内置选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9"><span class="toc-number">2.0.3.</span> <span class="toc-text">指定构建选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9%E4%BE%9D%E8%B5%96"><span class="toc-number">2.0.4.</span> <span class="toc-text">构建选项依赖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">检测开发环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">生成配置头文件</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E9%85%8D%E7%BD%AE/%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/Hexo+Obsidian%20%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5%E8%B7%B3%E8%BD%AC.html" title="Hexo+Obsidian 内部链接跳转">Hexo+Obsidian 内部链接跳转</a><time datetime="2023-07-24T07:53:49.000Z" title="发表于 2023-07-24 15:53:49">2023-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E9%85%8D%E7%BD%AE/ob%E9%85%8D%E7%BD%AE/%E5%BF%AB%E9%80%9F%E6%8F%92%E5%85%A5%E6%A8%A1%E6%9D%BF.html" title="快速插入模板">快速插入模板</a><time datetime="2023-07-20T07:34:25.000Z" title="发表于 2023-07-20 15:34:25">2023-07-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AF%AD%E8%A8%80/Rust/%E5%AE%89%E8%A3%85.html" title="安装">安装</a><time datetime="2023-07-20T02:27:40.000Z" title="发表于 2023-07-20 10:27:40">2023-07-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E9%85%8D%E7%BD%AE/ob%E9%85%8D%E7%BD%AE/%E9%99%84%E4%BB%B6%E7%AE%A1%E7%90%86.html" title="附件管理">附件管理</a><time datetime="2023-07-19T07:52:53.000Z" title="发表于 2023-07-19 15:52:53">2023-07-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AF%AD%E8%A8%80/c++/%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%92%8C%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E6%A3%80%E6%9F%A5%E7%9A%84%E4%B8%80%E7%AB%99%E5%BC%8F%E5%B7%A5%E4%BD%9C%E6%B5%81%20Cpp%20Linter.html" title="代码格式化和静态分析检查的一站式工作流 Cpp Linter">代码格式化和静态分析检查的一站式工作流 Cpp Linter</a><time datetime="2023-07-19T01:17:32.000Z" title="发表于 2023-07-19 09:17:32">2023-07-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By John Doe</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>